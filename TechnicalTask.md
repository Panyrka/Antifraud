# Техническое задание

Описание: в этом файле будут описаны основные характеристики всех объектов системы

## Основные составляющие

1. Входной балансировщик системы
2. Классификатор потока
3. Коннектор/Пул-ожидания для каждого потока
4. База данных
5. Everyday proccesses
6. Антифрод:
    1. Первичная обработка
    2. Энричмент-процесс
    3. Запись в базу данных сырых данных
    4. Проверка правил
    5. Передача ответа в коннектор (для передачи в систему источник)
    6. Запись решения по правилам в базу данных
    7. Заполнение профилей и list'ов
7.  Энричмент (+ база данных)
8.  Генератор транзакций
9.  GUI (Графический интерфейс)

## Описание каждой составляющей

### Входной балансировщик системы

**Задачи:**
1. Балансировать работу между серверами (будет один, но наверное всё равно можно сделать);

**Требования:**
1. Только порт этого сервиса открыт для внешнего коннекта;
2. Возможно использование HAProxy;
3. Можно не делать, а просто упомянуть в дипломе; **--сomment 07.03.23 Dima** 'Давай не будем делать, лишняя морока'

## Классификатор потоков

**Задачи:**
1. Должен проверить, что транзакция реально к "нам", то есть тип транзакции совпадает
2. Должен перенаправить транзакцию в нужный поток
3. Если не удается выполнить один из пунктов, возвращает ошибку в систему источник

**Требования:**
1. Частичное логгирование
2. Очень желательно сделать какую-то проверку, что нам прислал доверенный чел, а не какой-то левый

## Коннектор/пул-ожидания

**Задачи:**
1. Добавляет новую транзакцию в лист ожидания
2. Когда антифрод-процесс по данному потоку освободится, передавать в него транзакцию
3. Получать от антифрод-процесса ответ и передавать обратно системе-источнику

**Требования:**
1. Для каждого потока отдельный процесс
2. Частичное логгирование

## База данных

**Таблицы/БД:**
1. Таблица для raw transaction data
2. База данных для профилей, в базе данных создаётся таблица для каждого профиля
3. База данных для list'ов, в базе данных создаётся отдельная таблица для каждого list'а

**Требования:**
1. Должна быть доступна только для антифрод-процесса
2. PostgreSQL
3. В ней хранятся БД/таблицы для всего антифрода
4. Очень желательно использование индексов

## Everyday proccesses

**Задачи:**
1. Очистка старых профилей (например, профиль за 2 дня, нужно очистить всё, что раньше) **--сomment 07.03.23 Dima** 'Жесть ты запарился. Тоже думаю не надо.'
2. Очистка старых list'ов

**Требования:**
1. Запускаются раз в N промежуток времени

## Антифрод

**Требования:**
1. Отдельный процесс запускается для каждого потока
2. Предлагаю сделать 2 потока (от 2 СИ), 1 - ЮЛ, второй - ФЛ. Для каждого сделать несколько типов транзакций, по 1-2 БС и ЧС на поток, по 3 правила на поток.

### Антифрод/Первичная обработка

**Задачи:**
1. Принимает транзакции от коннектора
2. Проверяет транзакцию на целостность, то, что она именно для этого потока **--сomment 07.03.23 Dima** 'Предлагаю именно разделить потоки по СИ, и в рамках потока уже разделять по типам транзакций. Например, в канале ФЛ разделить на типы транзакций - "ФЛ_ПОКУПКА_В_РЕТЕЙЛ", "ФЛ_ПЕРЕВОД_СБП", "ФЛ_ОПЛАТА_УСЛУГ", а в ЮЛ - "ЮЛ_ПЛАТЕЖ","ЮЛ_ПЕРЕВОД_ЗАР_ПЛАТА" и пр.'
3. Передаёт в следующий процесс

### Антифрод/Энричмент-процесс

**Задачи:**
1. Отправляет запрос в энричмент, отправляет дальше
2. Если не получает ответ за N мс, то просто отправляет дальше 

### Антифрод/Запись в базу данных сырых данных

**Задачи:**

1. Запись обогащённой транзакции в БД
2. Происходит в отдельном потоке

### Антифрод/Проверка правил

**Задачи:**
1. Запускаются скрипты проверки для этого потока
2. Сохраняются результаты в отдельный массив

### Антифрод/Передача ответа в коннектор (для передачи в систему источник)

**Задачи:**
1. Отдаём ответ коннектору

### Антифрод/Запись решения по правилам в базу данных

**Задачи:**
1. Записываем в БД результаты работы правил

### Антифрод/Заполнение профилей и list'ов

**Задачи:**
1. Обновляем профили/листы

## Энричмент

**Задачи:**
1. Получает запрос по транзакции от антифрод
2. Отвечает

**Требования:**
1. Включает в себя отдельную БД PostgreSQL

## Генератор транзакций

**Задачи:**
1. Должен генерировать транзакции для проверки работоспособности сервера
2. Также должен уметь генерировать неправильные транзакции, чтобы проверять ошибки

## GUI (Графический интерфейс)

**Задачи:**
1. Выводит общую информацию по количеству обрабатываемых транзакций, срабатывающих правил, появляющихся ошибок
2. Редактор правил - описание для сработки правила, возможность указания типа ответа в СИ (систему источник) - ALLOW or DECLINE.
3. Списки - один из лучших и простейших способов показать логику работы. Список с черным списком клиентов, всегда одно из первых правил на потоке это проверка клиента в ЧС. Просто и понятно. Также можно сделать и БС. Мне кажется правила на списки и пару на суммы будет уже с головой.
